<script type="text/javascript" src="/js/objectlist.js"></script>
<link rel="stylesheet" href="/css/objectlist.css">

{{range $index,$line := .addtionalJs }}
<script type="text/javascript" src="{{ $line }}"></script>
{{end}}

<script language="javascript1.2">
	var popMenuItems = new Array();
	var pageUrl = {{.baseUri}};
	{{range $index,$line := .allPopMenuItems }}
	popMenuItems[{{- $index -}}] = {{- $line -}};
	{{end}}

	{{if gt (len .secondGroupSelect) 0 }}
	function ChangeSecondGroupOptions(parentID){
	  var secondGroupOptions = new Array();
	  {{range $index, $line := .secondGroupSelect}}
		{{$line}};
	  {{end}}

		var newOption;
		var newSecondOptions = document.getElementById("secondGroupSelectID");
		newSecondOptions.options.length = 0;

		var newThirdOptions = document.getElementById("thirdGroupSelectID");
		if(newThirdOptions) {
			newThirdOptions.options.length = 0;
			newOption = new Option("--请选择选项--", "0");
			newThirdOptions.options.add(newOption);
		}
		if(parentID == "0") {
			newOption = new Option("--请选择选项--", "0");
			newSecondOptions.options.add(newOption);
		} else {
			newOption = new Option("--请选择选项--", "0");
			newSecondOptions.options.add(newOption);
			for (var j in secondGroupOptions[parentID]) {
				newOption = new Option(secondGroupOptions[parentID][j][1], secondGroupOptions[parentID][j][0]);
				newSecondOptions.options.add(newOption);
			}
		}
	}
	{{end}}

	{{if gt (len .thirdGroupSelect) 0 }}
	function ChangeThirdGroupOptions(parentID){
		var thirdGroupOptions = new Array();
		{{range $index, $line := .thirdGroupSelect}}
		{{$line}};
		{{end}}

		var newOption;
		var newThirdOptions = document.getElementById("thirdGroupSelectID");
		newThirdOptions.options.length = 0;

		if(parentID == "0") {
			newOption = new Option("--请选择选项--", "0");
			newThirdOptions.options.add(newOption);
		} else {
			newOption = new Option("--请选择选项--", "0");
			newThirdOptions.options.add(newOption);
			for (var j in thirdGroupOptions[parentID]) {
				newOption = new Option(thirdGroupOptions[parentID][j][1], thirdGroupOptions[parentID][j][0]);
				newThirdOptions.options.add(newOption);
			}
		}
	}
	{{end}}

</script>

{{ $firstGroupSelectedID := .firstGroupSelectedID }}
{{ $secondGroupSelectedID := .secondGroupSelectedID }}
{{ $thirdGroupSelectedID := .thirdGroupSelectedID }}

<section class="content-header">
	<h1>
		{{ .mainCategory }}
		<small>{{ .subCategory }}</small>
	</h1>
</section>

{{ $groupSelectedID := .groupSelectID }}
<div>
	<div class="mutilSelectForm">
		<form id="groupSelect" name="groupSelect" method="post" target="_self" onsubmit="return false">
			{{if gt (len .firstGroupSelect) 0 }}
			   {{ .firstGroupTitle }}:
			   {{if gt (len .secondGroupSelect) 0 }}
			       <select name="firstGroupSelectID" onChange="ChangeSecondGroupOptions(this.options[this.options.selectedIndex].value)">
			   {{else}}
			       <select name="groupSelectID" onChange="GroupSelectChanged(this.options[this.options.selectedIndex].value)">
			   {{end}}
		       {{ range $index,$line := .firstGroupSelect }}
			   {{if eq $firstGroupSelectedID $line.Id }}
				   <option value="{{ $line.Id }}" selected> {{ $line.Text }} </option>
				{{else}}
				   <option value="{{ $line.Id }}" > {{ $line.Text }} </option>
				{{end}}
				{{end}}
			</select> &nbsp;
			{{ end }}
		   {{if gt (len .secondGroupSelect) 0 }}
	   	      {{ .secondGroupTitle }}:
    		   {{if gt (len .thirdGroupSelect) 0 }}
        		   <select name="secondGroupSelectID"  id="secondGroupSelectID" onChange="ChangeThirdGroupOptions(this.options[this.options.selectedIndex].value)">
			   {{else}}
    			   <select name="groupSelectID" id="secondGroupSelectID" onChange="GroupSelectChanged(this.options[this.options.selectedIndex].value)">
				{{end}}
					{{if gt (len .secondSelectedOptions) 0 }}
					   {{ range $index,$line := .secondSelectedOptions }}
					       {{if eq $secondGroupSelectedID $line.Id }}
					         <option value="{{ $line.Id }}" selected> {{ $line.Text }} </option>
					       {{else}}
					         <option value="{{ $line.Id }}" > {{ $line.Text }} </option>
					       {{end}}
					   {{end}}
					{{else}}
                      <option value="0" selected> ---选择选项--- </option>
					{{end}}
    		   </select>
		   {{end}}

		   {{if gt (len .thirdGroupSelect) 0 }}
        	   {{ .thirdGroupTitle }}:
				 <select name="groupSelectID" id="thirdGroupSelectID" onChange="GroupSelectChanged(this.options[this.options.selectedIndex].value)">
					 {{if gt (len .thirdSelectedOptions) 0 }}
					     {{ range $index,$line := .thirdSelectedOptions }}
					     {{if eq $thirdGroupSelectedID $line.Id }}
					        <option value="{{ $line.Id }}" selected> {{ $line.Text }} </option>
					     {{else}}
					        <option value="{{ $line.Id }}" > {{ $line.Text }} </option>
					     {{end}}
					     {{end}}
					 {{else}}
					    <option value="0" selected> ---选择选项--- </option>
					 {{end}}
			   </select>
		   {{end}}
		   {{ if .addButtonTitle }}
			<button id="buttonAdd" onclick="displayAddObjectForm() "> + {{ .addButtonTitle }} </button>&nbsp;
			{{ end }}
		</form>
	</div>

	{{ if .isSearchForm }}
	<div class="searchForm">
		<form id="searchForm" name="search" method="post" target="_self" onsubmit="return false">
			<input type="text" name="searchContent" placeholder="Search..." autocomplete="off" onblur="doSearch(this.value)" />
		</form>
	</div>
	{{ end }}
</div>

<form id="objectList" method="post" target="_self" onsubmit="return false">
	<table class="list-table">
		<tr>
			<th  align="left">
			<input type="checkbox" id="objectListTH" name="objectListTH[]" onclick='selectAllObjectCheckbox(this.checked)'>
			</th>
			{{range $index,$line := .thData }}
			<th>
				{{if eq $line.OrderUri "" }}
					{{ $line.Title }}
				{{else}}
					<a href="#" onclick='listContenChanged("{{ $line.OrderUri}}")' >
						{{ $line.Title }}
					</a>
					{{if $line.OrderSelected }}
						{{if eq $line.OrderDirection "1" }}
							<i class="fa fa-arrow-down"></i>
						{{else}}
							<i class="fa fa-arrow-up"></i>
						{{end}}
					{{end}}
				{{end}}
			</th>
			{{end}}
			<th > &nbsp; &nbsp;&nbsp;</th>
		</tr>

		{{range $index,$line := .objListData }}
		<tr>
			<td width="5%"> <input type="checkbox"  id="objectid[]" name="objectid[]" value="{{ $line.objectID }}" onclick='selectObjectCheckbox(this.checked)'></td>
			{{range $key,$value := $.thData }}
				<td >
					{{ index $line (print $value.ID) }}
				</td>
			{{end}}

			<td>
				<a href="#" id="popmenuid" onclick='showPopMenu(event,{{ $line.popmenuitems}}, {{ $line.objectID }})'> ... </a>
			</td>
		</tr>
		{{end}}
	</table>
</form>

<table class="foot-table">
	<tr>
		<td>
			<div class="div-foot">当前第{{ .currentPage }}页
				{{if eq (len .prePageUri)  0 }}
					前一页
				{{else}}
					<a href="#" onclick='listContenChanged("{{.prePageUri}}")' >前一页</a>
				{{end}}
				{{if eq (len .nextPageUri) 0 }}
					后一页
				{{else}}
					<a href="#" onclick='listContenChanged("{{.nextPageUri}}")' >后一页</a>
				{{end}}
			 共{{ .totalPage }}页 </div>
		</td>
	</tr>
</table>	

<div class="pop-menu" id="popmenu">
</div>

<div class="poppage" id="poppage">
</div>
